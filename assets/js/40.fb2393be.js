(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{464:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、nginx-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、nginx-安装"}},[t._v("#")]),t._v(" 一、Nginx 安装")]),t._v(" "),s("h3",{attrs:{id:"_1、版本区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、版本区别"}},[t._v("#")]),t._v(" 1、版本区别")]),t._v(" "),s("p",[t._v("常用版本分为四大阵营")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Nginx开源版")]),t._v(" "),s("p",[t._v("http://nginx.org/")])]),t._v(" "),s("li",[s("p",[t._v("Nginx plus 商业版")]),t._v(" "),s("p",[t._v("https://www.nginx.com")])]),t._v(" "),s("li",[s("p",[t._v("openresty")]),t._v(" "),s("p",[t._v("http://openresty.org/cn/")])]),t._v(" "),s("li",[s("p",[t._v("Tengine")]),t._v(" "),s("p",[t._v("http://tengine.taobao.org/")])])]),t._v(" "),s("h3",{attrs:{id:"_2、nginx-开源版本安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、nginx-开源版本安装"}},[t._v("#")]),t._v(" 2、Nginx 开源版本安装")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("编译安装")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-zxvf")]),t._v(" nginx-1.24.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.24.0\n./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("如果提示或报错")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("提示1：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" OS\n+ Linux "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.10")]),t._v(".0-693.el7.x86_64 x86_64\nchecking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" C compiler "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". not found\n./configure: error: C compiler cc is not found\n")])])]),s("p",[t._v("安装 gcc")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" gcc\n")])])])]),t._v(" "),s("li",[s("p",[t._v("提示2：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./configure: error: the HTTP rewrite module requires the PCRE library.\nYou can either disable the module by using --without-http_rewrite_module\noption, or "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" the PCRE library into the system, or build the PCRE library\nstatically from the "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" with nginx by using --with-pcre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" option.\n")])])]),s("p",[t._v("安装 perl 库")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" pcre pcre-devel\n")])])])]),t._v(" "),s("li",[s("p",[t._v("提示3：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./configure: error: the HTTP "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" module requires the zlib library.\nYou can either disable the module by using --without-http_gzip_module\noption, or "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" the zlib library into the system, or build the zlib library\nstatically from the "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" with nginx by using --with-zlib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" option.\n")])])]),s("p",[t._v("安装 zlib 库")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" zlib zlib-devel\n")])])])])])]),t._v(" "),s("li",[s("p",[t._v("启动Nginx")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/local/nginx\n./nginx 启动\n./nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" stop 快速停止\n./nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" quit 优雅关闭，在退出前完成已经接受的连接请求\n./nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload 重新加载配置\n")])])])]),t._v(" "),s("li",[s("p",[t._v("关于防火墙")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl stop firewalld.service\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭防火墙")]),t._v("\nsystemctl disable firewalld.service\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁止防火墙开机启动")]),t._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 放行 80 端口")]),t._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启防火墙")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("安装成系统服务")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("创建服务脚本")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /usr/lib/systemd/system/nginx.service\n")])])])]),t._v(" "),s("li",[s("p",[t._v("服务脚本内容")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx - web server\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("After")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("network.target remote-fs.target nss-lookup.target\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("forking\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PIDFile")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/logs/nginx.pid\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStartPre")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /usr/local/nginx/conf/nginx.conf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /usr/local/nginx/conf/nginx.conf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecReload")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStop")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" stop\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecQuit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" quit\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PrivateTmp")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("WantedBy")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("multi-user.target\n")])])])]),t._v(" "),s("li",[s("p",[t._v("重新加载系统服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl daemon-reload\n")])])])]),t._v(" "),s("li",[s("p",[t._v("启动服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl start nginx.service\n")])])])]),t._v(" "),s("li",[s("p",[t._v("开机启动")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" nginx.service\n")])])])])])])]),t._v(" "),s("h2",{attrs:{id:"二、nginx-基础使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、nginx-基础使用"}},[t._v("#")]),t._v(" 二、Nginx 基础使用")]),t._v(" "),s("h3",{attrs:{id:"_1、目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、目录结构"}},[t._v("#")]),t._v(" 1、目录结构")]),t._v(" "),s("p",[t._v("进入Nginx的主目录我们可以看到这些文件夹")]),t._v(" "),s("blockquote",[s("p",[t._v("client_body_temp")]),t._v(" "),s("p",[t._v("conf")]),t._v(" "),s("p",[t._v("fastcgi_temp")]),t._v(" "),s("p",[t._v("html")]),t._v(" "),s("p",[t._v("logs")]),t._v(" "),s("p",[t._v("proxy_temp")]),t._v(" "),s("p",[t._v("sbin")]),t._v(" "),s("p",[t._v("scgi_temp")]),t._v(" "),s("p",[t._v("uwsgi_temp")])]),t._v(" "),s("p",[t._v("其中这几个文件夹在刚安装后是没有的，主要用来存放运行过程中的临时文件")]),t._v(" "),s("blockquote",[s("p",[t._v("client_body_temp")]),t._v(" "),s("p",[t._v("fastcgi_temp")]),t._v(" "),s("p",[t._v("proxy_temp")]),t._v(" "),s("p",[t._v("scgi_temp")]),t._v(" "),s("p",[t._v("uwsgi_temp")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("conf")]),t._v(" "),s("p",[t._v("用来存放配置文件相关")])]),t._v(" "),s("li",[s("p",[t._v("html")]),t._v(" "),s("p",[t._v("用来存放静态文件的默认目录 html、css等")])]),t._v(" "),s("li",[s("p",[t._v("sbin")]),t._v(" "),s("p",[t._v("nginx的主程序")])]),t._v(" "),s("li",[s("p",[t._v("logs")]),t._v(" "),s("p",[t._v("存放 nginx的登录日志文件 access.log，错误日志文件 error.log 和 nginx的进程Id")])])]),t._v(" "),s("h3",{attrs:{id:"_2、基本运行原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、基本运行原理"}},[t._v("#")]),t._v(" 2、基本运行原理")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%9F%BA%E6%9C%AC%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86.png",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("Nginx主进程不负责处理业务，只负责协调子进程处理业务。")]),t._v(" "),s("p",[t._v("子进程获取用户请求后进行处理")])]),t._v(" "),s("h3",{attrs:{id:"_3、nginx-配置与应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、nginx-配置与应用场景"}},[t._v("#")]),t._v(" 3、Nginx 配置与应用场景")]),t._v(" "),s("h4",{attrs:{id:"_3-1-最小配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-最小配置"}},[t._v("#")]),t._v(" 3.1 最小配置")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("user nobody"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定 nginx 启动时什么用户来启动\t")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("worker_processes")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("worker_processes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认为1，表示开启一个业务进程，基本上一个cpu内核对应一个 worker_processes")]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("worker_connections")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("worker_connections "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单个业务进程可接受连接数")]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("include mime.types")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("include mime.types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引入http mime类型的配置文件，该文件存储的所有的请求头信息，可以识别要发送的文件的类型")]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("default_type application/octet-stream")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("default_type application/octet-stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果mime类型没匹配上，默认使用二进制流的方式传输。")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("sendfile on")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("sendfile on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用linux的 sendfile(socket, file, len) 高效网络传输，也就是数据0拷贝。")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("未开启sendfile")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%80%E5%B0%8F%E9%85%8D%E7%BD%AEsendfile%E6%9C%AA%E5%BC%80%E5%90%AF.png",alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("开启后")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%80%E5%B0%8F%E9%85%8D%E7%BD%AEsendfile%E5%BC%80%E5%90%AF%E5%90%8E.png",alt:""}})])])])]),t._v(" "),s("li",[s("p",[t._v("keepalive_timeout 65")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("keepalive_timeout "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以理解为保持链接，超时的时间")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("server")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一个 server 就是一个主机，开启多个主机的方式叫虚拟主机（vhost）")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听端口号")]),t._v("\n    server_name localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主机名，可以在此配置域名或主机名")]),t._v("\n    \n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配路径，指定是网络地址中主机名后面的部分")]),t._v("\n        root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件根目录")]),t._v("\n        index index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认页名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    error_page "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 报错编码对应页面")]),t._v("\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为50x.html设置访问路径，当用户访问50x.html，会去访问 html 目录下去寻找 50x.html页面")]),t._v("\n        root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("h4",{attrs:{id:"_3-2-虚拟主机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-虚拟主机"}},[t._v("#")]),t._v(" 3.2 虚拟主机")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%80%E5%B0%8F%E9%85%8D%E7%BD%AEserver.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("浏览器、Nginx与http协议")]),t._v(" "),s("ol",[s("li",[t._v("TCP协议：tcp是一个广泛的浏览器协议,它是以流的形式,进行传递数据的(数据是二进制的)")]),t._v(" "),s("li",[t._v("数据流:相当于一个水龙头,开启之后一直流通,没有关掉的动作")]),t._v(" "),s("li",[t._v("HTTP协议:是一个在TCP之上的协议,它会在里面告诉TCP协议什么时候关掉流,当用户的浏览器和Nginx服务器都遵守和实现了HTTP协议之后,他们之间就可以进行信息的交流、传递了。")]),t._v(" "),s("li",[t._v("HTTPS协议:HTTP之上的一个协议,加了一层数据加密的措施,保护数据。")]),t._v(" "),s("li",[t._v("请求流程:用户浏览器发送请求---\x3e 网关(层层网关)---\x3e---\x3e互联网---\x3eNginx服务器---\x3e解析请求---\x3e找到资源---\x3e返回给用户")])])]),t._v(" "),s("li",[s("p",[t._v("虚拟主机原理")]),t._v(" "),s("p",[t._v("如果有这样一个场景,假如一台主机只挂载了一个站点,当这个站点并没有太多的访问量时,就会造成资源过剩(有剩余资源),这时我们可以开启虚拟主机,挂载多个站点,合理的利用主机的资源。")]),t._v(" "),s("p",[t._v("一个IP地址可以对应多个域名,根据域名的不同,我们去寻找这些域名对应的资源目录,找到这些资源之后,返回给用户。")]),t._v(" "),s("p",[t._v("当然,我们需要在请求报文中加上这个域名,不然服务器不知道我们需要哪个域名的资源")])]),t._v(" "),s("li",[s("p",[t._v("使用host 文件解析域名")]),t._v(" "),s("p",[t._v("进行 C:\\Windows\\System32\\drivers\\etc 找到 hosts 文件，对文件内容进行修改，添加如下内容")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("192.168.37.128 wang128.com\n")])])]),s("blockquote",[s("p",[t._v("设置完成后可以ping通，但是网页访问出现 502 错误")]),t._v(" "),s("p",[t._v("解决方法：在网页设置中的代理选项中添加 "),s("code",[t._v("wang128.com")])]),t._v(" "),s("p",[t._v("这样可以在浏览器中输入该域名进而访问虚拟机中nginx对应的网页")])])]),t._v(" "),s("li",[s("p",[t._v("公网域名配置与泛域名解析实战")]),t._v(" "),s("p",[t._v("进入阿里云管理，点击域名，选择域名列表中自己申请的域名，点击解析，点击添加记录")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%85%AC%E7%BD%91%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98.png",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("在主机记录中可以添 * 以此来配置多级域名")])])]),t._v(" "),s("li",[s("p",[t._v("Nginx虚拟主机域名配置")]),t._v(" "),s("p",[t._v("首先需要在阿里云服务配置公网域名，并且公网域名的主机记录应当为 * ；接着在虚拟机中创建两个网页，分别是")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/usr/local/nginx/www/www/index.html\n/usr/local/nginx/www/vod/index.html\n")])])]),s("p",[t._v("接着在 "),s("code",[t._v("/usr/local/nginx/conf/nginx.conf")]),t._v(" 配置文件中进行如下配置")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一个 server 就是一个主机，开启多个主机的方式叫虚拟主机（vhost）")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听端口号")]),t._v("\n    server_name www.itwangcoder.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主机名，可以在此配置域名或主机名")]),t._v("\n    \n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配路径，指定是网络地址中主机名后面的部分")]),t._v("\n        root www/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件根目录")]),t._v("\n        index index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认页名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    error_page "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 报错编码对应页面")]),t._v("\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为50x.html设置访问路径，当用户访问50x.html，会去访问 html 目录下去寻找 50x.html页面")]),t._v("\n        root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一个 server 就是一个主机，开启多个主机的方式叫虚拟主机（vhost）")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听端口号")]),t._v("\n    server_name vod.itwangcoder.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主机名，可以在此配置域名或主机名")]),t._v("\n    \n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配路径，指定是网络地址中主机名后面的部分")]),t._v("\n        root www/vod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件根目录")]),t._v("\n        index index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认页名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    error_page "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 报错编码对应页面")]),t._v("\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为50x.html设置访问路径，当用户访问50x.html，会去访问 html 目录下去寻找 50x.html页面")]),t._v("\n        root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("注：在更改配置后需要重启服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl reload nginx.service\n")])])]),s("p",[t._v("这样就可以通过网址"),s("code",[t._v("www.itwangcoder.top")]),t._v("和"),s("code",[t._v("vod.itwangcoder.top")]),t._v("分别访问不同的虚拟主机（即配置的不同网页）")])])]),t._v(" "),s("li",[s("p",[t._v("serverName的多种匹配方式")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("serverName匹配规则")]),t._v(" "),s("p",[t._v("我们需要注意的是serverName匹配分先后顺序，写在前面的匹配上就不会继续往下匹配了。")])]),t._v(" "),s("li",[s("p",[t._v("完整匹配")]),t._v(" "),s("p",[t._v("我们可以在同一serverName中匹配多个域名")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server_name vod.itwangcoder.top vod1.itwangcoder.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("通配符匹配")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server_name *.itwangcoder.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("通配符结束匹配")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server_name vod.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("正则匹配")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server_name ~^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-9"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".itwangcoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".top$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])])]),t._v(" "),s("li",[s("p",[t._v("基于域名的几种互联网企业需求解析")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E7%9A%84%E5%87%A0%E7%A7%8D%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A%E9%9C%80%E6%B1%82%E8%A7%A3%E6%9E%901.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Nginx%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E7%9A%84%E5%87%A0%E7%A7%8D%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A%E9%9C%80%E6%B1%82%E8%A7%A3%E6%9E%902.png",alt:""}})])])]),t._v(" "),s("h3",{attrs:{id:"_4、反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、反向代理"}},[t._v("#")]),t._v(" 4、反向代理")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.png",alt:""}})]),t._v(" "),s("p",[t._v("、"),s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%AD%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86.png",alt:""}})]),t._v(" "),s("ol",[s("li",[s("p",[t._v("网关、代理与反向代理")]),t._v(" "),s("p",[t._v("正向代理是代理客户端，服务端不知道实际发起请求的客户端；反向代理是代理服务端，客户端不知道实际提供服务的服务端。")]),t._v(" "),s("p",[t._v("访问网络的入口称为"),s("strong",[t._v("网关")]),t._v("，代理服务器也是一种网关，所有请求都得经过网关转发")]),t._v(" "),s("p",[t._v("隧道式代理：Nginx的带宽就是整个网络集群的带宽，比较高的IO请求下，nginx做反向代理不合适。隧道式代理的含义是所有请求都只能通过nginx才能进出")]),t._v(" "),s("p",[t._v("lvs：指进入需要通过nginx进行访问，回传数据时由后端服务器直接把数据传给用户，这种称之为 DR 模型")])]),t._v(" "),s("li",[s("p",[t._v("反向代理在企业中的应用场景")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%AD%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%9C%A8%E4%BC%81%E4%B8%9A%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.png",alt:""}})])])]),t._v(" "),s("h3",{attrs:{id:"_5、基于反向代理的负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、基于反向代理的负载均衡"}},[t._v("#")]),t._v(" 5、基于反向代理的负载均衡")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("什么是负载均衡")]),t._v(" "),s("p",[t._v("早期的网站流量和业务功能都比较简单，单台服务器就可以满足基本需求，但是随着互联网的发展业务流量越来越大并且业务逻辑也越来越复杂，单台服务器的性能及单点故障问题就凸显出来了，因此需要多台服务器组成应用集群，进行性能的水平扩展以及避免单点故障出现。")]),t._v(" "),s("ul",[s("li",[t._v("应用集群：将同一应用部署到多台机器上，组成应用集群，接收负载均衡器分发的请求，进行业务处理并返回响应数据")]),t._v(" "),s("li",[t._v("负载均衡器：将用户请求根据对应的负载均衡算法分发到应用集群中的一台服务器进行处理")])])]),t._v(" "),s("li",[s("p",[t._v("反向代理到外网与内网的主机配置")]),t._v(" "),s("p",[t._v("配置跳转至外网网站，nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      \n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://www.atguigu.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root   html/dist;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("配置跳转至本机的服务器，nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("  server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      \n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \tproxy_pass http://192.168.37.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy_pass http://www.atguigu.com;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root   html/dist;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root   www/www;")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("负载均衡基本配置")]),t._v(" "),s("p",[t._v("nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\tupstream httpds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128:8081"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.101:80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy_pass http://qq.com;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy_pass http://192.168.37.101;")]),t._v("\n            proxy_pass http://httpds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root   html/dist;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root   www/www;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n     server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("负载均衡策略")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("轮询")]),t._v(" "),s("p",[t._v("默认情况下使用轮询方式，逐一转发，这种方式适用于无状态请求。")]),t._v(" "),s("blockquote",[s("p",[t._v("轮询策略无法保持会话")])])]),t._v(" "),s("li",[s("p",[t._v("weight(权重)")]),t._v(" "),s("p",[t._v("指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\tupstream httpds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128:8081 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" down"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.101:80 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" backup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("down：表示当前的server暂时不参与负载")]),t._v(" "),s("li",[t._v("weight：默认为1.weight越大，负载的权重就越大。")]),t._v(" "),s("li",[t._v("backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。")])])]),t._v(" "),s("li",[s("p",[t._v("ip_hash（"),s("strong",[t._v("不经常使用")]),t._v("）")]),t._v(" "),s("p",[t._v("根据客户端的ip地址转发同一台服务器，可以保持回话。")])]),t._v(" "),s("li",[s("p",[t._v("least_conn（"),s("strong",[t._v("不经常使用")]),t._v("）")]),t._v(" "),s("p",[t._v("最少连接访问")])]),t._v(" "),s("li",[s("p",[t._v("url_hash（"),s("strong",[t._v("不经常使用")]),t._v("）")]),t._v(" "),s("p",[t._v("根据用户访问的url定向转发请求")])]),t._v(" "),s("li",[s("p",[t._v("fair（"),s("strong",[t._v("不经常使用")]),t._v("）")]),t._v(" "),s("p",[t._v("根据后端服务器响应时间转发请求")])])])]),t._v(" "),s("li",[s("p",[t._v("动静分离的原理和使用场景")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%9F%BA%E4%BA%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF.png",alt:""}})]),t._v(" "),s("p",[t._v("首先将前端页面复制到apache-tomcat中的 webapps目录下，接着更改 conf/server.xml 配置文件，添加如下代码")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Context")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("docBase")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("reloadable")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("p",[t._v("nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://192.168.37.101:8080"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /css {")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#\troot   html/dist;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /js {")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#\troot   html/dist;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /img {")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#\troot   html/dist;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    index  index.html index.htm;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面是正则表达式写法")]),t._v("\n        location ~*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("img"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("fonts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \troot   html/dist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("正则表达式：location 前缀")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("/")]),t._v(" 通用匹配，任何请求都会匹配到。")]),t._v(" "),s("li",[s("code",[t._v("=")]),t._v(" 精准匹配，不是以指定模式开头")]),t._v(" "),s("li",[s("code",[t._v("~")]),t._v(" 正则匹配，区分大小写")]),t._v(" "),s("li",[s("code",[t._v("~*")]),t._v(" 正则匹配，不区分大小写")]),t._v(" "),s("li",[s("code",[t._v("^~")]),t._v(" 非正则匹配，匹配以指定模式开头的location")])]),t._v(" "),s("p",[t._v("location匹配顺序")]),t._v(" "),s("ul",[s("li",[t._v("多个正则location直接按书写顺序匹配，成功后就不会继续往后面匹配")]),t._v(" "),s("li",[t._v("普通（非正则）location会一直往下，直到找到匹配度最高的（最大前缀匹配）")]),t._v(" "),s("li",[t._v("当普通location与正则location同时存在，如果正则匹配成功,则不会再执行普通匹配")]),t._v(" "),s("li",[t._v("所有类型location存在时，“=”匹配 > “^~”匹配 > 正则匹配 > 普通（最大前缀匹配）")])])])]),t._v(" "),s("li",[s("p",[t._v("alias与root")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location /css "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("alias")]),t._v(" /usr/local/nginx/static/css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    index index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("root用来设置根目录，而alias在接受请求的时候在路径上不会加上location。")]),t._v(" "),s("ol",[s("li",[t._v("alias指定的目录是准确的，即location匹配访问的path目录下的文件直接是在alias目录下查找的；")]),t._v(" "),s("li",[t._v("root指定 的目录是location匹配访问的path目录的上一级目录,这个path目录一定要是真实存在root指定目录下的；")]),t._v(" "),s("li",[t._v('使用 alias标签的目录块中不能使用rewrite的break（具体原因不明）；另外，alias指定的目录后面必须要加上"/"符 号！！')]),t._v(" "),s("li",[t._v('alias虚拟目录配置中，location匹配的path目录如果后面不带"/"，那么访问的url地址中这个path目录后 面加不加"/"不影响访问，访问时它会自动加上"/"； 但是如果location匹配的path目录后面加上"/"，那么访问的url地 址中这个path目录必须要加上"/"，访问时它不会自动加上"/"。如果不加上"/"，访问就会失败！')]),t._v(" "),s("li",[t._v('root目录配置 中，location匹配的path目录后面带不带"/"，都不会影响访问。')])])])]),t._v(" "),s("li",[s("p",[t._v("URLRewrite")]),t._v(" "),s("p",[t._v("nginx.conf 配置文件修改如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\trewrite ^/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-9"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".html$ /index.jsp?pageNum"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_pass http://192.168.37.128:8080"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("rewrite是实现URL重写的关键指令，根据regex (正则表达式)部分内容， 重定向到replacement，结尾是flag标记。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("rewrite "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("regex"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("replacement"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("flag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("rewrite")]),t._v(" "),s("th",[t._v("<regex>")]),t._v(" "),s("th",[t._v("<replacement>")]),t._v(" "),s("th",[t._v("[flag]")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("关键字")]),t._v(" "),s("td",[t._v("正则")]),t._v(" "),s("td",[t._v("替代内容")]),t._v(" "),s("td",[t._v("flag标记")])])])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("关键字：其中关键字error_log不能改变")])]),t._v(" "),s("li",[s("p",[t._v("正则：perl兼容正则表达式语句进行规则匹配")])]),t._v(" "),s("li",[s("p",[t._v("替代内容：将正则匹配的内容替换成replacement")])]),t._v(" "),s("li",[s("p",[t._v("flag标记：rewrite支持的flag标记")])])]),t._v(" "),s("p",[t._v("rewrite参数的标签段位置： server,location,if")]),t._v(" "),s("p",[t._v("flag标记说明：")]),t._v(" "),s("ul",[s("li",[t._v("last #本条规则匹配完成后，继续向下匹配新的location URI规则")]),t._v(" "),s("li",[t._v("break #本条规则匹配完成即终止，不再匹配后面的任何规则")]),t._v(" "),s("li",[t._v("redirect #返回302临时重定向，浏览器地址会显示跳转后的URL地址")]),t._v(" "),s("li",[t._v("permanent #返回301永久重定向，浏览器地址栏会显示跳转后的URL地址")])])])]),t._v(" "),s("li",[s("p",[t._v("负载均衡与URLRewrite")]),t._v(" "),s("p",[t._v("应用服务器防火墙配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("开启防火墙")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl start firewalld\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("重启防火墙")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl restart firewalld\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("重载规则")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("查看已配置规则")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("firewall-cmd --list-all\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("指定端口和ip访问")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v(" --add-rich-rule"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rule family="')]),t._v("ipv4"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" source address="')]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" port protocol="')]),t._v("tcp"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" port="')]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" accept"')]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("移除规则")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v(" --remove-rich-rule"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rule family="')]),t._v("ipv4"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" source address="')]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" port port="')]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" protocol="')]),t._v("tcp"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" accept"')]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("网关配置")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("upstream httpds "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".44.128 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".44.101:8080 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rewrite ^/([0-9]+).html$ /index.jsp?pageNum=$1 redirect;")]),t._v("\n    proxy_pass http://httpds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])])])])]),t._v(" "),s("li",[s("p",[t._v("防盗链")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("valid_referers none "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" blocked "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" server_names "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" strings "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])])]),s("blockquote",[s("ul",[s("li",[t._v("none， 检测 Referer 头域不存在的情况。")]),t._v(" "),s("li",[t._v("blocked，检测 Referer 头域的值被防火墙或者代理服务器删除或伪装的情况。这种情况该头域的值不以 “http://” 或 “https://” 开头。")]),t._v(" "),s("li",[t._v("server_names ，设置一个或多个 URL ，检测 Referer 头域的值是否是这些 URL 中的某一个。")])])]),t._v(" "),s("p",[t._v("在需要防盗链的location中配置")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("    \tlocation ~*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("img"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("fonts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            valid_referers none "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            root   html/dist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",[s("li",[s("p",[t._v("使用curl测试")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" http://192.168.37.128/img/logo.053d32eb.png\n")])])])]),t._v(" "),s("li",[s("p",[t._v("带引用")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://baidu.com"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" http://192.168.37.128/img/logo.053d32eb.png\n")])])])]),t._v(" "),s("li",[s("p",[t._v("企业实战盗链资源返回页面或提示图片")]),t._v(" "),s("p",[t._v("首先创建一个页面 401.html")]),t._v(" "),s("p",[t._v("接着修改配置文件内容 nginx.conf，添加如下内容")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" \t\terror_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),t._v("  /401.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /401.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 想要返回图片，需要修改如下内容")]),t._v("\n\t\tlocation ~*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("img"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("fonts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            valid_referers none "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \trewrite ^/\t/img/x.png\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# return 403;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            root   html/dist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])]),t._v(" "),s("h3",{attrs:{id:"_6、高可用配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、高可用配置"}},[t._v("#")]),t._v(" 6、高可用配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("高可用场景及解决方案")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE%E5%9C%BA%E6%99%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.png",alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("安装 keepalived")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("编译安装")]),t._v(" "),s("p",[t._v("下载地址：https://www.keepalived.org/download.html#")]),t._v(" "),s("p",[t._v("使用 ./configure 编译安装")]),t._v(" "),s("blockquote",[s("p",[t._v("如遇报错提示")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("configure: error:\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" OpenSSL is not properly installed on your system. "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Can not include OpenSSL headers files. "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),s("p",[t._v("安装依赖")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" openssl-devel\n")])])])])]),t._v(" "),s("li",[s("p",[t._v("yum 安装")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" keepalived\n")])])]),s("blockquote",[s("p",[s("strong",[t._v("出现错误")]),t._v("：")]),t._v(" "),s("p",[t._v("错误：软件包：1:net-snmp-agent-libs-5.7.2-49.el7_9.2.x86_64 (updates)\n需要：libmysqlclient.so.18()(64bit)\n错误：软件包：2:postfix-2.10.1-9.el7.x86_64 (@anaconda)\n需要：libmysqlclient.so.18(libmysqlclient_18)(64bit)")]),t._v(" "),s("p",[s("strong",[t._v("解决方案")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("到官网（https://dev.mysql.com/downloads/mysql/）下载mysql-community-libs-compat-8.0.31-1.el7.x86_64.rpm\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ivh")]),t._v(" mysql-community-libs-compat-8.0.31-1.el7.x86_64.rpm\n")])])])])]),t._v(" "),s("li",[s("p",[t._v("配置")]),t._v(" "),s("p",[t._v("使用 yum 安装后配置文件位置在 "),s("code",[t._v("/etc/keepalived/keepalived.conf")])]),t._v(" "),s("p",[t._v("第一台机器")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Configuration File "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" keepalived\nglobal_defs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\trouter_id lb111\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvrrp_instance itwang "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# keepalived 在内网中通讯的协议 ， 后面的是实例名称")]),t._v("\n    state MASTER\n    interface ens33\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要和电脑上的网卡对应上")]),t._v("\n    virtual_router_id "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 优先级")]),t._v("\n    advert_int "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 间隔检测时间")]),t._v("\n    authentication "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 keepaliveed 同一组的认证配置")]),t._v("\n        auth_type PASS\n        auth_pass "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟的ip地址")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.200\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("第二台机器")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Configuration File "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" keepalived\nglobal_defs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\trouter_id lb110\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvrrp_instance itwang "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# keepalived 在内网中通讯的协议 ， 后面的是实例名称")]),t._v("\n    state BACKUP\n    interface ens33\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要和电脑上的网卡对应上")]),t._v("\n    virtual_router_id "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 优先级")]),t._v("\n    advert_int "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 间隔检测时间")]),t._v("\n    authentication "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 keepaliveed 同一组的认证配置")]),t._v("\n        auth_type PASS\n        auth_pass "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟的ip地址")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".37.200\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("启动服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl start keepalived\n")])])])])])])]),t._v(" "),s("h3",{attrs:{id:"_7、https-证书配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7、https-证书配置"}},[t._v("#")]),t._v(" 7、Https 证书配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("不安全的http协议")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Http%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84http%E5%8D%8F%E8%AE%AE.png",alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("非对称加密算法原理")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Http%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86.png",alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("HTTPS中CA机构参与保证互联网安全")]),t._v(" "),s("p",[s("img",{attrs:{src:"Nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E7%AF%87/Nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8Https%E4%B8%ADCA%E6%9C%BA%E6%9E%84%E5%8F%82%E4%B8%8E%E4%BF%9D%E8%AF%81%E4%BA%92%E8%81%94%E7%BD%91%E5%AE%89%E5%85%A8.png",alt:""}})]),t._v(" "),s("p",[t._v("window上查看所有证书信息：win+R后输入 certmgr.msc 即可")])]),t._v(" "),s("li",[s("p",[t._v("证书自签名")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("OpenSSL")]),t._v(" "),s("p",[t._v("openssl包含：SSL协议库、应用程序以及密码算法库，系统内置")])]),t._v(" "),s("li",[s("p",[t._v("图形化工具 XCA")]),t._v(" "),s("p",[t._v("下载地址：https://www.hohnstaedt.de/xca/index.php/download")])])])]),t._v(" "),s("li",[s("p",[t._v("在线证书申请")])])]),t._v(" "),s("h2",{attrs:{id:"三、"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、"}},[t._v("#")]),t._v(" 三、")])])}),[],!1,null,null,null);s.default=e.exports}}]);