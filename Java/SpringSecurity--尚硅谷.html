<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringSecurity学习笔记尚硅谷 | itwangcoder&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/vuepressblog/img/logo.png">
    <meta name="description" content="SpringSecurity学习笔记尚硅谷">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/vuepressblog/assets/css/0.styles.e7a65157.css" as="style"><link rel="preload" href="/vuepressblog/assets/js/app.80634c63.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/3.ef187fa4.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/1.93e2b1ee.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/27.3d604a05.js" as="script"><link rel="preload" href="/vuepressblog/assets/js/9.76c7ad5c.js" as="script"><link rel="prefetch" href="/vuepressblog/assets/js/10.987eeee2.js"><link rel="prefetch" href="/vuepressblog/assets/js/11.e2698b0f.js"><link rel="prefetch" href="/vuepressblog/assets/js/12.d1a773de.js"><link rel="prefetch" href="/vuepressblog/assets/js/13.b1124dce.js"><link rel="prefetch" href="/vuepressblog/assets/js/14.d43425cc.js"><link rel="prefetch" href="/vuepressblog/assets/js/15.301d4ee9.js"><link rel="prefetch" href="/vuepressblog/assets/js/16.fb92ba76.js"><link rel="prefetch" href="/vuepressblog/assets/js/17.ad9b924f.js"><link rel="prefetch" href="/vuepressblog/assets/js/18.b28999b2.js"><link rel="prefetch" href="/vuepressblog/assets/js/19.ae4fe37d.js"><link rel="prefetch" href="/vuepressblog/assets/js/20.8648e605.js"><link rel="prefetch" href="/vuepressblog/assets/js/21.afba39d8.js"><link rel="prefetch" href="/vuepressblog/assets/js/22.a421ec88.js"><link rel="prefetch" href="/vuepressblog/assets/js/23.43bb5f78.js"><link rel="prefetch" href="/vuepressblog/assets/js/24.5300c069.js"><link rel="prefetch" href="/vuepressblog/assets/js/25.e5fe554e.js"><link rel="prefetch" href="/vuepressblog/assets/js/26.d4f0f7c0.js"><link rel="prefetch" href="/vuepressblog/assets/js/28.5b15f884.js"><link rel="prefetch" href="/vuepressblog/assets/js/29.f763d748.js"><link rel="prefetch" href="/vuepressblog/assets/js/30.2d33ed3c.js"><link rel="prefetch" href="/vuepressblog/assets/js/31.63dec94e.js"><link rel="prefetch" href="/vuepressblog/assets/js/32.1d419569.js"><link rel="prefetch" href="/vuepressblog/assets/js/33.dd0d73a3.js"><link rel="prefetch" href="/vuepressblog/assets/js/34.11980da6.js"><link rel="prefetch" href="/vuepressblog/assets/js/35.60c39dd1.js"><link rel="prefetch" href="/vuepressblog/assets/js/36.3eb7aee1.js"><link rel="prefetch" href="/vuepressblog/assets/js/37.9b1bc008.js"><link rel="prefetch" href="/vuepressblog/assets/js/38.05776efb.js"><link rel="prefetch" href="/vuepressblog/assets/js/39.7ae3eed8.js"><link rel="prefetch" href="/vuepressblog/assets/js/4.fadd923b.js"><link rel="prefetch" href="/vuepressblog/assets/js/40.fb2393be.js"><link rel="prefetch" href="/vuepressblog/assets/js/41.5f5dec94.js"><link rel="prefetch" href="/vuepressblog/assets/js/42.b9f6299c.js"><link rel="prefetch" href="/vuepressblog/assets/js/43.b3178a1b.js"><link rel="prefetch" href="/vuepressblog/assets/js/5.b07d85ee.js"><link rel="prefetch" href="/vuepressblog/assets/js/6.cdd119e1.js"><link rel="prefetch" href="/vuepressblog/assets/js/7.fe6c61b0.js"><link rel="prefetch" href="/vuepressblog/assets/js/8.d08f9a62.js">
    <link rel="stylesheet" href="/vuepressblog/assets/css/0.styles.e7a65157.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>itwangcoder's blog</h3> <p class="description" data-v-59e6cb88>我的个人网站</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>itwangcoder</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressblog/" class="home-link router-link-active"><img src="/vuepressblog/img/logo.png" alt="itwangcoder's blog" class="logo"> <span class="site-name">itwangcoder's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressblog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/vuepressblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  百度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/vuepressblog/img/logo.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    itwangcoder
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>31</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>32</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepressblog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/vuepressblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  百度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>SpringSecurity学习笔记尚硅谷</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>itwangcoder</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">SpringSecurity学习笔记尚硅谷</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>itwangcoder</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/12/20</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>尚硅谷</span><span class="tag-item" data-v-8a445198>Java</span><span class="tag-item" data-v-8a445198>框架</span><span class="tag-item" data-v-8a445198>Spring框架</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="spring-security"><a href="#spring-security" class="header-anchor">#</a> Spring Security</h1> <h2 id="_1、springsecurity-框架简介"><a href="#_1、springsecurity-框架简介" class="header-anchor">#</a> 1、SpringSecurity 框架简介</h2> <h3 id="_1-1-概要"><a href="#_1-1-概要" class="header-anchor">#</a> 1.1 概要</h3> <p>Spring 是非常流行和成功的 Java 应用开发框架，Spring Security 正是 Spring 家族中的 成员。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。</p> <p>正如你可能知道的关于安全方面的两个主要区域是“认证”和“授权”（或者访问控 制），一般来说，Web 应用的安全性包括用户认证（Authentication）和用户授权 （Authorization）两个部分，这两点也是 Spring Security 重要核心功能。</p> <p>（1）用户认证指的是：验证某个用户是否为系统中的合法主体，也就是说用户能否访问 该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认 证过程。通俗点说就是系统认为用户是否能登录</p> <p>（2）用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户 所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以 进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的 权限。通俗点讲就是系统判断用户是否有权限去做某些事情。</p> <h3 id="_1-2-历史"><a href="#_1-2-历史" class="header-anchor">#</a> 1.2 历史</h3> <p>“Spring Security 开始于 2003 年年底,““spring 的 acegi 安全系统”。 起因是 Spring 开发者邮件列表中的一个问题,有人提问是否考虑提供一个基于 spring 的安全实现。</p> <p>Spring Security 以“The Acegi Secutity System for Spring” 的名字始于 2013 年晚些 时候。一个问题提交到 Spring 开发者的邮件列表，询问是否已经有考虑一个机遇 Spring  的安全性社区实现。那时候 Spring 的社区相对较小（相对现在）。实际上 Spring 自己在 2013 年只是一个存在于 ScourseForge 的项目，这个问题的回答是一个值得研究的领 域，虽然目前时间的缺乏组织了我们对它的探索。</p> <p>考虑到这一点，一个简单的安全实现建成但是并没有发布。几周后，Spring 社区的其他成 员询问了安全性，这次这个代码被发送给他们。其他几个请求也跟随而来。到 2014 年一 月大约有 20 万人使用了这个代码。这些创业者的人提出一个 SourceForge 项目加入是为 了，这是在 2004 三月正式成立。</p> <p>在早些时候，这个项目没有任何自己的验证模块，身份验证过程依赖于容器管理的安全性 和 Acegi 安全性。而不是专注于授权。开始的时候这很适合，但是越来越多的用户请求额 外的容器支持。容器特定的认证领域接口的基本限制变得清晰。还有一个相关的问题增加 新的容器的路径，这是最终用户的困惑和错误配置的常见问题。</p> <p>Acegi 安全特定的认证服务介绍。大约一年后，Acegi 安全正式成为了 Spring 框架的子项 目。1.0.0 最终版本是出版于 2006 -在超过两年半的大量生产的软件项目和数以百计的改 进和积极利用社区的贡献。</p> <p>Acegi 安全 2007 年底正式成为了 Spring 组合项目，更名为&quot;Spring Security&quot;。</p> <h3 id="_1-3-同款产品对比"><a href="#_1-3-同款产品对比" class="header-anchor">#</a> 1.3 同款产品对比</h3> <h4 id="_1-3-1-spring-security"><a href="#_1-3-1-spring-security" class="header-anchor">#</a> 1.3.1 Spring Security</h4> <p>Spring 技术栈的组成部分。</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/%E5%90%8C%E6%AC%BE%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94SpringSecurity.png" alt=""></p> <p>通过提供完整可扩展的认证和授权支持保护你的应用程序。 https://spring.io/projects/spring-security</p> <p>SpringSecurity 特点：</p> <ul><li>和 Spring 无缝整合。</li> <li>全面的权限控制。</li> <li>专门为 Web 开发而设计。
<ul><li>旧版本不能脱离 Web 环境使用。</li> <li>新版本对整个框架进行了分层抽取，分成了核心模块和 Web 模块。单独 引入核心模块就可以脱离 Web 环境。</li></ul></li> <li>重量级。</li></ul> <h4 id="_1-3-2-shiro"><a href="#_1-3-2-shiro" class="header-anchor">#</a> 1.3.2 Shiro</h4> <p>Apache 旗下的轻量级权限控制框架。</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/%E5%90%8C%E6%AC%BE%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94Shiro.png" alt=""></p> <p>特点：</p> <ul><li><p>轻量级。Shiro 主张的理念是把复杂的事情变简单。针对对性能有更高要求 的互联网应用有更好表现。</p></li> <li><p>通用性。</p> <ul><li>好处：不局限于 Web 环境，可以脱离 Web 环境使用。</li> <li>缺陷：在 Web 环境下一些特定的需求需要手动编写代码定制。</li></ul></li></ul> <p>Spring Security 是 Spring 家族中的一个安全管理框架，实际上，在 Spring Boot 出现之 前，Spring Security 就已经发展了多年了，但是使用的并不多，安全管理这个领域，一直 是 Shiro 的天下。</p> <p>相对于 Shiro，在 SSM 中整合 Spring Security 都是比较麻烦的操作，所以，Spring  Security 虽然功能比 Shiro 强大，但是使用反而没有 Shiro 多（Shiro 虽然功能没有 Spring Security 多，但是对于大部分项目而言，Shiro 也够用了）。</p> <p>自从有了 Spring Boot 之后，Spring Boot 对于 Spring Security 提供了自动化配置方 案，可以使用更少的配置来使用 Spring Security。</p> <p>因此，一般来说，常见的安全管理技术栈的组合是这样的：</p> <ul><li>SSM + Shiro</li> <li>Spring Boot/Spring Cloud + Spring Security</li></ul> <p>以上只是一个推荐的组合而已，如果单纯从技术上来说，无论怎么组合，都是可以运行 的。</p> <h3 id="_1-4-模块划分"><a href="#_1-4-模块划分" class="header-anchor">#</a> 1.4 模块划分</h3> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86.png" alt=""></p> <h2 id="_2、springsecurity-入门案例"><a href="#_2、springsecurity-入门案例" class="header-anchor">#</a> 2、SpringSecurity 入门案例</h2> <h3 id="_2-1-创建一个项目"><a href="#_2-1-创建一个项目" class="header-anchor">#</a> 2.1 创建一个项目</h3> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE.png" alt=""></p> <p>添加一个配置类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfigextends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 表单登录</span>
			<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        	<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 认证配置</span>
			<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 任何请求</span>
			<span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 都需要身份验证</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-运行这个项目"><a href="#_2-2-运行这个项目" class="header-anchor">#</a> 2.2 运行这个项目</h3> <p>访问 localhost:8080</p> <p>默认的用户名：user 密码在项目启动的时候在控制台会打印，注意每次启动的时候密码都回发生变化！</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/%E8%BF%90%E8%A1%8C%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%AF%86%E7%A0%81.png" alt=""></p> <p>输入用户名，密码，这样表示可以访问了，404 表示我们没有这个控制器，但是我们可以 访问了。</p> <h3 id="_2-3-权限管理中的相关概念"><a href="#_2-3-权限管理中的相关概念" class="header-anchor">#</a> 2.3 权限管理中的相关概念</h3> <h4 id="_2-3-1-主体"><a href="#_2-3-1-主体" class="header-anchor">#</a> 2.3.1 主体</h4> <p>英文单词：principal</p> <p>使用系统的用户或设备或从其他系统远程登录的用户等等。简单说就是谁使用系 统谁就是主体。</p> <h4 id="_2-3-2-认证"><a href="#_2-3-2-认证" class="header-anchor">#</a> 2.3.2 认证</h4> <p>英文单词：authentication</p> <p>权限管理系统确认一个主体的身份，允许主体进入系统。简单说就是“主体”证 明自己是谁。</p> <p>笼统的认为就是以前所做的登录操作。</p> <h4 id="_2-3-3-授权"><a href="#_2-3-3-授权" class="header-anchor">#</a> 2.3.3 授权</h4> <p>英文单词：authorization</p> <p>将操作系统的“权力”“授予”“主体”，这样主体就具备了操作系统中特定功能的能力。</p> <p>所以简单来说，授权就是给用户分配权限。</p> <h3 id="_2-4-添加一个控制器进行访问"><a href="#_2-4-添加一个控制器进行访问" class="header-anchor">#</a> 2.4 添加一个控制器进行访问</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-5-springsecurity-基本原理"><a href="#_2-5-springsecurity-基本原理" class="header-anchor">#</a> 2.5 SpringSecurity 基本原理</h3> <p>SpringSecurity 本质是一个过滤器链：</p> <p>从启动是可以获取到过滤器链：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span>async<span class="token punctuation">.</span></span>WebAsyncManagerIntegrationFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>SecurityContextPersistenceFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>header<span class="token punctuation">.</span></span>HeaderWriterFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>csrf<span class="token punctuation">.</span></span>CsrfFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>logout<span class="token punctuation">.</span></span>LogoutFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span>UsernamePasswordAuthenticationFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span>DefaultLoginPageGeneratingFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span>DefaultLogoutPageGeneratingFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>savedrequest<span class="token punctuation">.</span></span>RequestCacheAwareFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servletapi<span class="token punctuation">.</span></span>SecurityContextHolderAwareRequestFilter</span>
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span>AnonymousAuthenticationFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span>SessionManagementFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>access<span class="token punctuation">.</span></span>ExceptionTranslationFilter</span> 
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>access<span class="token punctuation">.</span>intercept<span class="token punctuation">.</span></span>FilterSecurityInterceptor</span>
</code></pre></div><p>代码底层流程：重点看三个过滤器：</p> <p>FilterSecurityInterceptor：是一个方法级的权限过滤器, 基本位于过滤链的最底部。</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/SpringSecurity%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%861.png" alt=""></p> <p>super.beforeInvocation(fi) 表示查看之前的 filter 是否通过。</p> <p>fi.getChain().doFilter(fi.getRequest(), fi.getResponse());表示真正的调用后台的服务。</p> <p>ExceptionTranslationFilter：是个异常过滤器，用来处理在认证授权过程中抛出的异常</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/SpringSecurity%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%862.png" alt=""></p> <p>UsernamePasswordAuthenticationFilter ：对/login 的 POST 请求做拦截，校验表单中用户 名，密码。</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/SpringSecurity%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%863.png" alt=""></p> <h3 id="_2-6-userdetailsservice-接口讲解"><a href="#_2-6-userdetailsservice-接口讲解" class="header-anchor">#</a> 2.6 UserDetailsService 接口讲解</h3> <p>当什么也没有配置的时候，账号和密码是由 Spring Security 定义生成的。而在实际项目中 账号和密码都是从数据库中查询出来的。 所以我们要通过自定义逻辑控制认证逻辑。</p> <p>如果需要自定义逻辑时，只需要实现 UserDetailsService 接口即可。接口定义如下：</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/UserDetailsService%E6%8E%A5%E5%8F%A3%E8%AE%B2%E8%A7%A31.png" alt=""></p> <ul><li>返回值 UserDetails</li></ul> <p>这个类是系统默认的用户“主体”</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 表示获取登录用户所有权限</span>
<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示获取密码</span>
<span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示获取用户名</span>
<span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示判断账户是否过期</span>
<span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示判断账户是否被锁定</span>
<span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示凭证{密码}是否过期</span>
<span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示当前用户是否可用</span>
<span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以下是 UserDetails 实现类</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/UserDetailsService%E6%8E%A5%E5%8F%A3%E8%AE%B2%E8%A7%A32.png" alt=""></p> <p>以后我们只需要使用 User 这个实体类即可！</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/UserDetailsService%E6%8E%A5%E5%8F%A3%E8%AE%B2%E8%A7%A33.png" alt=""></p> <ul><li>方法参数 username</li></ul> <p>表示用户名。此值是客户端表单传递过来的数据。默认情况下必须叫 username，否则无法接收。</p> <h3 id="_2-7-passwordencoder-接口讲解"><a href="#_2-7-passwordencoder-接口讲解" class="header-anchor">#</a> 2.7 PasswordEncoder 接口讲解</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 表示把参数按照特定的解析规则进行解析</span>
<span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示验证从存储中获取的编码密码与编码后提交的原始密码是否匹配。如果密码匹配，则返回 true；如果不匹配，则返回 false。第一个参数表示需要被解析的密码。第二个参数表示存储的密码。</span>
<span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示如果解析的密码能够再次进行解析且达到更安全的结果则返回 true，否则返回false。默认返回 false。</span>
<span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">upgradeEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接口实现类</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurity%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/PasswordEncoder%E6%8E%A5%E5%8F%A3%E8%AE%B2%E8%A7%A3.png" alt=""></p> <p>BCryptPasswordEncoder 是 Spring Security 官方推荐的密码解析器，平时多使用这个解析器。</p> <p>BCryptPasswordEncoder 是对 bcrypt 强散列方法的具体实现。是基于 Hash 算法实现的单 向加密。可以通过 strength 控制加密强度，默认 10.</p> <ul><li>查用方法演示</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 创建密码解析器</span>
    <span class="token class-name">BCryptPasswordEncoder</span> bCryptPasswordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对密码进行加密</span>
    <span class="token class-name">String</span> atguigu <span class="token operator">=</span> bCryptPasswordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印加密之后的数据</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;加密之后数据：\t&quot;</span><span class="token operator">+</span>atguigu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断原字符加密后和加密之前是否匹配</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> bCryptPasswordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">,</span> atguigu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印比较结果</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;比较结果：\t&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-8-springboot-对-security-的自动配置"><a href="#_2-8-springboot-对-security-的自动配置" class="header-anchor">#</a> 2.8 SpringBoot 对 Security 的自动配置</h3> <p>https://docs.spring.io/springsecurity/site/docs/5.3.4.RELEASE/reference/html5/#servlet-hello</p> <h2 id="_3、springsecurity-web-权限方案"><a href="#_3、springsecurity-web-权限方案" class="header-anchor">#</a> 3、SpringSecurity Web 权限方案</h2> <h3 id="_3-1-设置登录系统的账号、密码"><a href="#_3-1-设置登录系统的账号、密码" class="header-anchor">#</a> 3.1 设置登录系统的账号、密码</h3> <p>方式一：在application.properties</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">spring.security.user.name</span><span class="token punctuation">=</span><span class="token value attr-value">atguigu</span>
<span class="token key attr-name">spring.security.user.password</span><span class="token punctuation">=</span><span class="token value attr-value">atguigu</span>
</code></pre></div><p>方式二：编写类实现接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注入 PasswordEncoder 类到 spring 容器中</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断用户名是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户名不存在！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从数据库中获取的密码 atguigu 的密文</span>
        <span class="token class-name">String</span> pwd <span class="token operator">=</span> <span class="token string">&quot;$2a$10$2R/M6iU3mCZt3ByG7kwYTeeW0w7/UqdeXrb27zkBIizBvAven0/na&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 第三个参数表示权限</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>pwd<span class="token punctuation">,</span><span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;admin,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2-实现数据库认证来完成用户登录"><a href="#_3-2-实现数据库认证来完成用户登录" class="header-anchor">#</a> 3.2 实现数据库认证来完成用户登录</h3> <p>完成自定义登录</p> <h4 id="_3-2-1-准备sql"><a href="#_3-2-1-准备sql" class="header-anchor">#</a> 3.2.1 准备sql</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> users<span class="token punctuation">(</span>
    id <span class="token keyword">bigint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unique</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    password <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 密码 atguigu</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'张san'</span><span class="token punctuation">,</span><span class="token string">'$2a$10$2R/M6iU3mCZt3ByG7kwYTeeW0w7/UqdeXrb27zkBIizBvAven0/na'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 密码 atguigu</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'李si'</span><span class="token punctuation">,</span><span class="token string">'$2a$10$2R/M6iU3mCZt3ByG7kwYTeeW0w7/UqdeXrb27zkBIizBvAven0/na'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> role<span class="token punctuation">(</span>
    id <span class="token keyword">bigint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'管理员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'普通用户'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> role_user<span class="token punctuation">(</span>
    uid <span class="token keyword">bigint</span><span class="token punctuation">,</span>
    rid <span class="token keyword">bigint</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role_user <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role_user <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> menu<span class="token punctuation">(</span>
    id <span class="token keyword">bigint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    parentid <span class="token keyword">bigint</span><span class="token punctuation">,</span>
    permission <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> menu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'系统管理'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'menu:system'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> menu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'用户管理'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'menu:user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> role_menu<span class="token punctuation">(</span>
    mid <span class="token keyword">bigint</span><span class="token punctuation">,</span>
    rid <span class="token keyword">bigint</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role_menu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role_menu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> role_menu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-2-添加依赖"><a href="#_3-2-2-添加依赖" class="header-anchor">#</a> 3.2.2 添加依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--mybatis-plus--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--mysql--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--lombok 用来简化实体类--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_3-2-3-制作实体类"><a href="#_3-2-3-制作实体类" class="header-anchor">#</a> 3.2.3 制作实体类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-4-整合mybatisplus-制作-mapper"><a href="#_3-2-4-整合mybatisplus-制作-mapper" class="header-anchor">#</a> 3.2.4 整合MybatisPlus 制作 mapper</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsersMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

配置文件添加数据库配置 
#mysql 数据库连接
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>spring_security<span class="token operator">?</span>serverTimezone<span class="token operator">=</span><span class="token constant">GMT</span><span class="token operator">%</span><span class="token number">2</span><span class="token constant">B8</span><span class="token operator">&amp;</span>characterEncoding<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span><span class="token operator">&amp;</span>userSSL<span class="token operator">=</span><span class="token boolean">false</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span>root
</code></pre></div><h4 id="_3-2-5-制作登录实现类"><a href="#_3-2-5-制作登录实现类" class="header-anchor">#</a> 3.2.5 制作登录实现类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;userDetailsService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UsersMapper</span> usersMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Users</span> users <span class="token operator">=</span> usersMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>users <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户名不存在！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> auths <span class="token operator">=</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>auths<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-6-测试访问"><a href="#_3-2-6-测试访问" class="header-anchor">#</a> 3.2.6 测试访问</h4> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AE.png" alt=""></p> <p>输入用户名，密码</p> <h3 id="_3-3-未认证请求跳转到登录页"><a href="#_3-3-未认证请求跳转到登录页" class="header-anchor">#</a> 3.3 未认证请求跳转到登录页</h3> <h4 id="_3-3-1-引入前端模板依赖"><a href="#_3-3-1-引入前端模板依赖" class="header-anchor">#</a> 3.3.1 引入前端模板依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_3-3-2-引入登录页面"><a href="#_3-3-2-引入登录页面" class="header-anchor">#</a> 3.3.2 引入登录页面</h4> <p>将准备好的登录页面导入项目中</p> <h4 id="_3-3-3-编写控制器"><a href="#_3-3-3-编写控制器" class="header-anchor">#</a> 3.3.3 编写控制器</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;findAll&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;findAll&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-3-4-编写配置类放行登录页面以及静态资源"><a href="#_3-3-4-编写配置类放行登录页面以及静态资源" class="header-anchor">#</a> 3.3.4 编写配置类放行登录页面以及静态资源</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注入 PasswordEncoder 类到 spring 容器中</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/layui/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span> <span class="token comment">//表示配置请求路径</span>
            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 指定 URL 无需保护。</span>
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 其他请求</span>
            <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要认证</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-3-5-测试"><a href="#_3-3-5-测试" class="header-anchor">#</a> 3.3.5 测试</h4> <p>访问 localhost:8090/index</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E6%9C%AA%E8%AE%A4%E8%AF%81%E8%AF%B7%E6%B1%82%E8%B7%B3%E8%BD%AC%E8%87%B3%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E6%B5%8B%E8%AF%95.png" alt=""></p> <p>访问 localhost:8090/findAll 会提示 403 错误 表示没有这个权限。</p> <h4 id="_3-3-6-设置未授权的请求跳转到登录页"><a href="#_3-3-6-设置未授权的请求跳转到登录页" class="header-anchor">#</a> 3.3.6 设置未授权的请求跳转到登录页</h4> <div class="language-java extra-class"><pre class="language-java"><code>配置类
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配置认证</span>
    http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 配置哪个 url 为登录页面</span>
        <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 设置哪个是登录的 url。</span>
        <span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/success&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 登录成功之后跳转到哪个 url</span>
        <span class="token punctuation">.</span><span class="token function">failureForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 登录失败之后跳转到哪个 url</span>
    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/layui/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span> <span class="token comment">//表示配置请求路径</span>
        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 指定 URL 无需保护。</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 其他请求</span>
        <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要认证</span>
    <span class="token comment">// 关闭 csrf</span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


控制器
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/success&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/fail&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fail&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span>method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
    用户名<span class="token operator">:</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
    密码：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span>name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span>value<span class="token operator">=</span><span class="token string">&quot;提交&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div><p>注意：页面提交方式必须为 post 请求，所以上面的页面不能使用，用户名，密码必须为 username,password</p> <p>原因： 在执行登录的时候会走一个过滤器 UsernamePasswordAuthenticationFilter</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E8%AE%BE%E7%BD%AE%E6%9C%AA%E8%AE%A4%E8%AF%81%E8%AF%B7%E6%B1%82%E8%B7%B3%E8%BD%AC%E8%87%B3%E7%99%BB%E5%BD%95%E9%A1%B51.png" alt=""></p> <p>如果修改配置可以调用 usernameParameter()和 passwordParameter()方法。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span><span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loginAcct<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userPswd<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E8%AE%BE%E7%BD%AE%E6%9C%AA%E8%AE%A4%E8%AF%81%E8%AF%B7%E6%B1%82%E8%B7%B3%E8%BD%AC%E8%87%B3%E7%99%BB%E5%BD%95%E9%A1%B52.png" alt=""></p> <h3 id="_3-4-基于角色或权限进行访问控制"><a href="#_3-4-基于角色或权限进行访问控制" class="header-anchor">#</a> 3.4 基于角色或权限进行访问控制</h3> <h4 id="_3-4-1-hasauthority-方法"><a href="#_3-4-1-hasauthority-方法" class="header-anchor">#</a> 3.4.1 hasAuthority 方法</h4> <p>如果当前的主体具有指定的权限，则返回 true,否则返回 false</p> <ul><li>修改配置类</li></ul> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasAuthority%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E7%B1%BB.png" alt=""></p> <ul><li>添加一个控制器</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/find&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;find&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>给用户登录主体赋予权限</li></ul> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasAuthority%E7%BB%99%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E4%B8%BB%E4%BD%93%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90.png" alt=""></p> <ul><li>测试：</li></ul> <p>http://localhost:8090/findAll 访问 findAll 进入登录页面</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasAuthority%E6%B5%8B%E8%AF%95.png" alt=""></p> <p>认证完成之后返回登录成功</p> <h4 id="_3-4-2-hasanyauthority-方法"><a href="#_3-4-2-hasanyauthority-方法" class="header-anchor">#</a> 3.4.2 hasAnyAuthority 方法</h4> <p>如果当前的主体有任何提供的角色（给定的作为一个逗号分隔的字符串列表）的话，返回 true.</p> <p>访问 http://localhost:8090/find</p> <h4 id="_3-4-3-hasrole-方法"><a href="#_3-4-3-hasrole-方法" class="header-anchor">#</a> 3.4.3 hasRole 方法</h4> <p>如果用户具备给定角色就允许访问,否则出现 403。</p> <p>如果当前主体具有指定的角色，则返回 true。</p> <p>底层源码：</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasRole%E5%BA%95%E5%B1%82%E6%BA%90%E7%A0%81.png" alt=""></p> <p>给用户添加角色：</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasRole%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E8%A7%92%E8%89%B2.png" alt=""></p> <p>修改配置文件：</p> <p>注意配置文件中不需要添加”ROLE_“，因为上述的底层代码会自动添加与之进行匹配。</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasRole%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt=""></p> <h4 id="_3-4-4-hasanyrole"><a href="#_3-4-4-hasanyrole" class="header-anchor">#</a> 3.4.4 hasAnyRole</h4> <p>表示用户具备任何一个条件都可以访问。</p> <p>给用户添加角色：</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasAnyRole%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E8%A7%92%E8%89%B2.png" alt=""></p> <p>修改配置文件：</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/hasAnyRole%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt=""></p> <h3 id="_3-5-基于数据库实现权限认证"><a href="#_3-5-基于数据库实现权限认证" class="header-anchor">#</a> 3.5 基于数据库实现权限认证</h3> <h4 id="_3-5-1-添加实体类"><a href="#_3-5-1-添加实体类" class="header-anchor">#</a> 3.5.1 添加实体类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> parentId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> permission<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-5-2-编写接口与实现类"><a href="#_3-5-2-编写接口与实现类" class="header-anchor">#</a> 3.5.2 编写接口与实现类</h4> <p>UserInfoMapper</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* 根据用户 Id 查询用户角色
* @param userId
* @return
*/</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectRoleByUserId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
* 根据用户 Id 查询菜单
* @param userId
* @return
*/</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Menu</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectMenuByUserId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

上述接口需要进行多表管理查询：
需要在 resource<span class="token operator">/</span>mapper 目录下自定义 <span class="token class-name">UserInfoMapper</span><span class="token punctuation">.</span>xml 
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span>encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token class-name">DOCTYPEmapperPUBLIC</span><span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mybatis<span class="token punctuation">.</span>org<span class="token operator">/</span>dtd<span class="token operator">/</span>mybatis<span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span>mapper<span class="token punctuation">.</span>dtd&quot;<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">&quot;com.atguigu.mapper.UserInfoMapper&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>根据用户 <span class="token class-name">Id</span> 查询角色信息<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectRoleByUserId&quot;</span>resultType<span class="token operator">=</span><span class="token string">&quot;com.atguigu.bean.Role&quot;</span><span class="token operator">&gt;</span>
        <span class="token constant">SELECT</span> r<span class="token punctuation">.</span>id<span class="token punctuation">,</span>r<span class="token punctuation">.</span>name <span class="token constant">FROM</span> role r <span class="token constant">INNER</span> <span class="token constant">JOIN</span> role_user ru <span class="token constant">ON</span> ru<span class="token punctuation">.</span>rid<span class="token operator">=</span>r<span class="token punctuation">.</span>id where ru<span class="token punctuation">.</span>uid<span class="token operator">=</span>#<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>根据用户 <span class="token class-name">Id</span> 查询权限信息<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectMenuByUserId&quot;</span>resultType<span class="token operator">=</span><span class="token string">&quot;com.atguigu.bean.Menu&quot;</span><span class="token operator">&gt;</span>
        <span class="token constant">SELECT</span> m<span class="token punctuation">.</span>id<span class="token punctuation">,</span>m<span class="token punctuation">.</span>name<span class="token punctuation">,</span>m<span class="token punctuation">.</span>url<span class="token punctuation">,</span>m<span class="token punctuation">.</span>parentid<span class="token punctuation">,</span>m<span class="token punctuation">.</span>permission <span class="token constant">FROM</span> menu m
        <span class="token constant">INNER</span> <span class="token constant">JOIN</span> role_menu rm <span class="token constant">ON</span> m<span class="token punctuation">.</span>id<span class="token operator">=</span>rm<span class="token punctuation">.</span>mid
        <span class="token constant">INNER</span> <span class="token constant">JOIN</span> role r <span class="token constant">ON</span> r<span class="token punctuation">.</span>id<span class="token operator">=</span>rm<span class="token punctuation">.</span>rid
        <span class="token constant">INNER</span> <span class="token constant">JOIN</span> role_user ru <span class="token constant">ON</span> r<span class="token punctuation">.</span>id<span class="token operator">=</span>ru<span class="token punctuation">.</span>rid
        <span class="token constant">WHERE</span> ru<span class="token punctuation">.</span>uid<span class="token operator">=</span>#<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre></div><p>UsersServiceImpl</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt=""></p> <h4 id="_3-5-3-在配置文件中添加映射"><a href="#_3-5-3-在配置文件中添加映射" class="header-anchor">#</a> 3.5.3 在配置文件中添加映射</h4> <p>在配置文件中 application.yml 添加</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
	<span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
</code></pre></div><h4 id="_3-5-4-修改访问配置类"><a href="#_3-5-4-修改访问配置类" class="header-anchor">#</a> 3.5.4 修改访问配置类</h4> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E4%BF%AE%E6%94%B9%E8%AE%BF%E9%97%AE%E9%85%8D%E7%BD%AE%E7%B1%BB.png" alt=""></p> <h4 id="_3-5-5-使用管理员与非管理员进行测试"><a href="#_3-5-5-使用管理员与非管理员进行测试" class="header-anchor">#</a> 3.5.5 使用管理员与非管理员进行测试</h4> <p>如果非管理员测试会提示 403 没有权限</p> <h3 id="_3-6-自定义403页面"><a href="#_3-6-自定义403页面" class="header-anchor">#</a> 3.6 自定义403页面</h3> <h4 id="_3-6-1-修改访问配置类"><a href="#_3-6-1-修改访问配置类" class="header-anchor">#</a> 3.6.1 修改访问配置类</h4> <div class="language-java extra-class"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accessDeniedPage</span><span class="token punctuation">(</span><span class="token string">&quot;/unauth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-6-2-添加对应控制器"><a href="#_3-6-2-添加对应控制器" class="header-anchor">#</a> 3.6.2 添加对应控制器</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/unauth&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">accessDenyPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;unauth&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


unauth<span class="token punctuation">.</span>html
<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
	<span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span>对不起，您没有访问权限！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_3-6-3-测试"><a href="#_3-6-3-测试" class="header-anchor">#</a> 3.6.3 测试</h4> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E8%87%AA%E5%AE%9A%E4%B9%89403%E9%A1%B5%E9%9D%A2%E6%B5%8B%E8%AF%95.png" alt=""></p> <h3 id="_3-7-注解使用"><a href="#_3-7-注解使用" class="header-anchor">#</a> 3.7 注解使用</h3> <h4 id="_3-7-1-secured"><a href="#_3-7-1-secured" class="header-anchor">#</a> 3.7.1 @Secured</h4> <p>判断是否具有角色，另外需要注意的是这里匹配的字符串需要添加前缀“ROLE_“。 使用注解先要开启注解功能！</p> <p>@EnableGlobalMethodSecurity(securedEnabled=true)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>securedEnabled<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemosecurityApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemosecurityApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在控制器方法上添加注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 测试注解：</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;testSecured&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@Secured</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;ROLE_normal&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;hello,user&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Secured</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;ROLE_normal&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ROLE_管理员&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>登录之后直接访问：http://localhost:8090/testSecured 控制器</p> <p>将上述的角色改为 @Secured({&quot;ROLE_normal&quot;,&quot;ROLE_管理员&quot;})即可访问</p> <h4 id="_3-7-2-preauthorize"><a href="#_3-7-2-preauthorize" class="header-anchor">#</a> 3.7.2 @PreAuthorize</h4> <p>先开启注解功能：</p> <p>@EnableGlobalMethodSecurity(prePostEnabled = true)</p> <p>@PreAuthorize：注解适合进入方法前的权限验证， @PreAuthorize 可以将登录用 户的 roles/permissions 参数传到方法中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/preAuthorize&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token comment">//@PreAuthorize(&quot;hasRole('ROLE_管理员')&quot;)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAnyAuthority('menu:system')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">preAuthorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;preAuthorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;preAuthorize&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用李四登录测试：</p> <h4 id="_3-7-3-postauthorize"><a href="#_3-7-3-postauthorize" class="header-anchor">#</a> 3.7.3 @PostAuthorize</h4> <p>先开启注解功能：</p> <p>@EnableGlobalMethodSecurity(prePostEnabled = true)</p> <p>@PostAuthorize 注解使用并不多，在方法执行后再进行权限验证，适合验证带有返回值 的权限.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testPostAuthorize&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@PostAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAnyAuthority('menu:system')&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">preAuthorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;test--PostAuthorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;PostAuthorize&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用李四登录测试：</p> <h4 id="_3-7-4-postfilter"><a href="#_3-7-4-postfilter" class="header-anchor">#</a> 3.7.4 @PostFilter</h4> <p>@PostFilter ：权限验证之后对数据进行过滤 留下用户名是 admin1 的数据</p> <p>表达式中的 filterObject 引用的是方法返回值 List 中的某一个元素</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;getAll&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole('ROLE_管理员')&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostFilter</span><span class="token punctuation">(</span><span class="token string">&quot;filterObject.username == 'admin1'&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token number">1l</span><span class="token punctuation">,</span><span class="token string">&quot;admin1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;6666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token number">2l</span><span class="token punctuation">,</span><span class="token string">&quot;admin2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-7-5-prefilter"><a href="#_3-7-5-prefilter" class="header-anchor">#</a> 3.7.5 @PreFilter</h4> <p>@PreFilter: 进入控制器之前对数据进行过滤</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;getTestPreFilter&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole('ROLE_管理员')&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreFilter</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;filterObject.id%2==0&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTestPreFilter</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span>t<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>先登录，然后使用 postman 进行测试</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8@PreFilter%E6%B5%8B%E8%AF%951.png" alt=""></p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8@PreFilter%E6%B5%8B%E8%AF%952.png" alt=""></p> <p>测试的 Json 数据：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;666&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admins&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;888&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admins11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11888&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admins22&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22888&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="_3-7-6-权限表达式"><a href="#_3-7-6-权限表达式" class="header-anchor">#</a> 3.7.6 权限表达式</h4> <p>https://docs.spring.io/springsecurity/site/docs/5.3.4.RELEASE/reference/html5/#el-access</p> <h3 id="_3-8-基于数据库的记住我"><a href="#_3-8-基于数据库的记住我" class="header-anchor">#</a> 3.8 基于数据库的记住我</h3> <h4 id="_3-8-1-创建表"><a href="#_3-8-1-创建表" class="header-anchor">#</a> 3.8.1 创建表</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>persistent_logins<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>series<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>token<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>last_used<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> 
    <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>series<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-8-2-添加数据库的配置文件"><a href="#_3-8-2-添加数据库的配置文件" class="header-anchor">#</a> 3.8.2 添加数据库的配置文件</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">datasource</span><span class="token punctuation">:</span>
<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.200.128<span class="token punctuation">:</span>3306/test
<span class="token key atrule">username</span><span class="token punctuation">:</span> root
<span class="token key atrule">password</span><span class="token punctuation">:</span> root
</code></pre></div><h4 id="_3-8-3-编写配置类"><a href="#_3-8-3-编写配置类" class="header-anchor">#</a> 3.8.3 编写配置类</h4> <p>创建配置类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrowserSecurityConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PersistentTokenRepository</span> <span class="token function">persistentTokenRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">JdbcTokenRepositoryImpl</span> jdbcTokenRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTokenRepositoryImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 赋值数据源</span>
        jdbcTokenRepository<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 自动创建表,第一次执行会创建，以后要执行就要删除掉！</span>
        jdbcTokenRepository<span class="token punctuation">.</span><span class="token function">setCreateTableOnStartup</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jdbcTokenRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-8-4-修改安全配置类"><a href="#_3-8-4-修改安全配置类" class="header-anchor">#</a> 3.8.4 修改安全配置类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">UsersServiceImpl</span> usersService<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">PersistentTokenRepository</span> tokenRepository<span class="token punctuation">;</span>
<span class="token comment">// 开启记住我功能</span>
http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">tokenRepository</span><span class="token punctuation">(</span>tokenRepository<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>usersService<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-8-5-页面添加记住我复选框"><a href="#_3-8-5-页面添加记住我复选框" class="header-anchor">#</a> 3.8.5 页面添加记住我复选框</h4> <div class="language-html extra-class"><pre class="language-html"><code>记住我：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span><span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remember-me<span class="token punctuation">&quot;</span></span><span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>记住密码<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>此处：name 属性值必须位 remember-me.不能改为其他值</p> <h4 id="_3-8-6-使用张三进行登录测试"><a href="#_3-8-6-使用张三进行登录测试" class="header-anchor">#</a> 3.8.6 使用张三进行登录测试</h4> <p>登录成功之后，关闭浏览器再次访问 http://localhost:8090/find，发现依然可以使用！</p> <h4 id="_3-8-7-设置有效期"><a href="#_3-8-7-设置有效期" class="header-anchor">#</a> 3.8.7 设置有效期</h4> <p>默认 2 周时间。但是可以通过设置状态有效时间，即使项目重新启动下次也可以正常登录。</p> <p>在配置文件中设置</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%B0%E4%BD%8F%E6%88%91%E8%AE%BE%E7%BD%AE%E6%9C%89%E6%95%88%E6%9C%9F.png" alt=""></p> <h3 id="_3-9-用户注销"><a href="#_3-9-用户注销" class="header-anchor">#</a> 3.9 用户注销</h3> <h4 id="_3-9-1-在登录页面添加一个退出连接"><a href="#_3-9-1-在登录页面添加一个退出连接" class="header-anchor">#</a> 3.9.1 在登录页面添加一个退出连接</h4> <p>success.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    登录成功<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/logout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>退出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_3-9-2-在配置类中添加退出映射地址"><a href="#_3-9-2-在配置类中添加退出映射地址" class="header-anchor">#</a> 3.9.2 在配置类中添加退出映射地址</h4> <div class="language-java extra-class"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-9-3-测试"><a href="#_3-9-3-测试" class="header-anchor">#</a> 3.9.3 测试</h4> <p>退出之后，是无法访问需要登录时才能访问的控制器！</p> <h3 id="_3-10-csrf"><a href="#_3-10-csrf" class="header-anchor">#</a> 3.10 CSRF</h3> <h4 id="_3-10-1-csrf-理解"><a href="#_3-10-1-csrf-理解" class="header-anchor">#</a> 3.10.1 CSRF 理解</h4> <p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click  attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已 登录的 Web 应用程序上执行非本意的操作的攻击方法。跟跨网站脚本（XSS）相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。</p> <p>跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个 自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买 商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。 这利用了 web 中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的 浏览器，却不能保证请求本身是用户自愿发出的。</p> <p>从 Spring Security 4.0 开始，默认情况下会启用 CSRF 保护，以防止 CSRF 攻击应用 程序，Spring Security CSRF 会针对 PATCH，POST，PUT 和 DELETE 方法进行防护。</p> <h4 id="_3-10-2-案例"><a href="#_3-10-2-案例" class="header-anchor">#</a> 3.10.2 案例</h4> <p>在登录页面添加一个隐藏域：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span><span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${_csrf}!=null<span class="token punctuation">&quot;</span></span><span class="token attr-name"><span class="token namespace">th:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${_csrf.token}<span class="token punctuation">&quot;</span></span><span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_csrf<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>关闭安全配置的类中的 csrf</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// http.csrf().disable();</span>
</code></pre></div><h4 id="_3-10-3-spring-security-实现-csrf-的原理"><a href="#_3-10-3-spring-security-实现-csrf-的原理" class="header-anchor">#</a> 3.10.3 Spring Security 实现 CSRF 的原理：</h4> <ol><li>生成 csrfToken 保存到 HttpSession 或者 Cookie 中。</li></ol> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/CSRF%E4%B8%ADSpringSecurity%E5%AE%9E%E7%8E%B0CSRF%E7%9A%84%E5%8E%9F%E7%90%861.png" alt=""></p> <p>SaveOnAccessCsrfToken 类有个接口 CsrfTokenRepository</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/CSRF%E4%B8%ADSpringSecurity%E5%AE%9E%E7%8E%B0CSRF%E7%9A%84%E5%8E%9F%E7%90%862.png" alt=""></p> <p>当前接口实现类：HttpSessionCsrfTokenRepository，CookieCsrfTokenRepository</p> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/CSRF%E4%B8%ADSpringSecurity%E5%AE%9E%E7%8E%B0CSRF%E7%9A%84%E5%8E%9F%E7%90%863.png" alt=""></p> <ol start="2"><li>请求到来时，从请求中提取 csrfToken，和保存的 csrfToken 做比较，进而判断当 前请求是否合法。主要通过 CsrfFilter 过滤器来完成。</li></ol> <p><img src="SpringSecurity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%9A%E7%A1%85%E8%B0%B7/SpringSecurityWeb%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88/CSRF%E4%B8%ADSpringSecurity%E5%AE%9E%E7%8E%B0CSRF%E7%9A%84%E5%8E%9F%E7%90%864.png" alt=""></p> <h2 id="_4、springsecurity-微服务权限方案"><a href="#_4、springsecurity-微服务权限方案" class="header-anchor">#</a> 4、SpringSecurity 微服务权限方案</h2> <h3 id="_4-1"><a href="#_4-1" class="header-anchor">#</a> 4.1</h3> <h3 id="_4-2"><a href="#_4-2" class="header-anchor">#</a> 4.2</h3> <h3 id="_4-3"><a href="#_4-3" class="header-anchor">#</a> 4.3</h3> <h3 id="_4-4"><a href="#_4-4" class="header-anchor">#</a> 4.4</h3> <h2 id="_5、springsecurity-原理总结"><a href="#_5、springsecurity-原理总结" class="header-anchor">#</a> 5、SpringSecurity 原理总结</h2> <h3 id="_5-1"><a href="#_5-1" class="header-anchor">#</a> 5.1</h3> <h3 id="_5-2"><a href="#_5-2" class="header-anchor">#</a> 5.2</h3> <h3 id="_5-3"><a href="#_5-3" class="header-anchor">#</a> 5.3</h3> <h3 id="_5-4"><a href="#_5-4" class="header-anchor">#</a> 5.4</h3> <h3 id="_5-5"><a href="#_5-5" class="header-anchor">#</a> 5.5</h3></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023/12/20 21:49:55</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_1、springsecurity-框架简介" class="sidebar-link reco-side-_1、springsecurity-框架简介" data-v-b57cc07c>1、SpringSecurity 框架简介</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_1-1-概要" class="sidebar-link reco-side-_1-1-概要" data-v-b57cc07c>1.1 概要</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_1-2-历史" class="sidebar-link reco-side-_1-2-历史" data-v-b57cc07c>1.2 历史</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_1-3-同款产品对比" class="sidebar-link reco-side-_1-3-同款产品对比" data-v-b57cc07c>1.3 同款产品对比</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_1-4-模块划分" class="sidebar-link reco-side-_1-4-模块划分" data-v-b57cc07c>1.4 模块划分</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2、springsecurity-入门案例" class="sidebar-link reco-side-_2、springsecurity-入门案例" data-v-b57cc07c>2、SpringSecurity 入门案例</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-1-创建一个项目" class="sidebar-link reco-side-_2-1-创建一个项目" data-v-b57cc07c>2.1 创建一个项目</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-2-运行这个项目" class="sidebar-link reco-side-_2-2-运行这个项目" data-v-b57cc07c>2.2 运行这个项目</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-3-权限管理中的相关概念" class="sidebar-link reco-side-_2-3-权限管理中的相关概念" data-v-b57cc07c>2.3 权限管理中的相关概念</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-4-添加一个控制器进行访问" class="sidebar-link reco-side-_2-4-添加一个控制器进行访问" data-v-b57cc07c>2.4 添加一个控制器进行访问</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-5-springsecurity-基本原理" class="sidebar-link reco-side-_2-5-springsecurity-基本原理" data-v-b57cc07c>2.5 SpringSecurity 基本原理</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-6-userdetailsservice-接口讲解" class="sidebar-link reco-side-_2-6-userdetailsservice-接口讲解" data-v-b57cc07c>2.6 UserDetailsService 接口讲解</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-7-passwordencoder-接口讲解" class="sidebar-link reco-side-_2-7-passwordencoder-接口讲解" data-v-b57cc07c>2.7 PasswordEncoder 接口讲解</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_2-8-springboot-对-security-的自动配置" class="sidebar-link reco-side-_2-8-springboot-对-security-的自动配置" data-v-b57cc07c>2.8 SpringBoot 对 Security 的自动配置</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3、springsecurity-web-权限方案" class="sidebar-link reco-side-_3、springsecurity-web-权限方案" data-v-b57cc07c>3、SpringSecurity Web 权限方案</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-1-设置登录系统的账号、密码" class="sidebar-link reco-side-_3-1-设置登录系统的账号、密码" data-v-b57cc07c>3.1 设置登录系统的账号、密码</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-2-实现数据库认证来完成用户登录" class="sidebar-link reco-side-_3-2-实现数据库认证来完成用户登录" data-v-b57cc07c>3.2 实现数据库认证来完成用户登录</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-3-未认证请求跳转到登录页" class="sidebar-link reco-side-_3-3-未认证请求跳转到登录页" data-v-b57cc07c>3.3 未认证请求跳转到登录页</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-4-基于角色或权限进行访问控制" class="sidebar-link reco-side-_3-4-基于角色或权限进行访问控制" data-v-b57cc07c>3.4 基于角色或权限进行访问控制</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-5-基于数据库实现权限认证" class="sidebar-link reco-side-_3-5-基于数据库实现权限认证" data-v-b57cc07c>3.5 基于数据库实现权限认证</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-6-自定义403页面" class="sidebar-link reco-side-_3-6-自定义403页面" data-v-b57cc07c>3.6 自定义403页面</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-7-注解使用" class="sidebar-link reco-side-_3-7-注解使用" data-v-b57cc07c>3.7 注解使用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-8-基于数据库的记住我" class="sidebar-link reco-side-_3-8-基于数据库的记住我" data-v-b57cc07c>3.8 基于数据库的记住我</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-9-用户注销" class="sidebar-link reco-side-_3-9-用户注销" data-v-b57cc07c>3.9 用户注销</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_3-10-csrf" class="sidebar-link reco-side-_3-10-csrf" data-v-b57cc07c>3.10 CSRF</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_4、springsecurity-微服务权限方案" class="sidebar-link reco-side-_4、springsecurity-微服务权限方案" data-v-b57cc07c>4、SpringSecurity 微服务权限方案</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_4-1" class="sidebar-link reco-side-_4-1" data-v-b57cc07c>4.1</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_4-2" class="sidebar-link reco-side-_4-2" data-v-b57cc07c>4.2</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_4-3" class="sidebar-link reco-side-_4-3" data-v-b57cc07c>4.3</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_4-4" class="sidebar-link reco-side-_4-4" data-v-b57cc07c>4.4</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5、springsecurity-原理总结" class="sidebar-link reco-side-_5、springsecurity-原理总结" data-v-b57cc07c>5、SpringSecurity 原理总结</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5-1" class="sidebar-link reco-side-_5-1" data-v-b57cc07c>5.1</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5-2" class="sidebar-link reco-side-_5-2" data-v-b57cc07c>5.2</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5-3" class="sidebar-link reco-side-_5-3" data-v-b57cc07c>5.3</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5-4" class="sidebar-link reco-side-_5-4" data-v-b57cc07c>5.4</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepressblog/Java/SpringSecurity--%E5%B0%9A%E7%A1%85%E8%B0%B7.html#_5-5" class="sidebar-link reco-side-_5-5" data-v-b57cc07c>5.5</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div></div><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/vuepressblog/assets/js/app.80634c63.js" defer></script><script src="/vuepressblog/assets/js/3.ef187fa4.js" defer></script><script src="/vuepressblog/assets/js/1.93e2b1ee.js" defer></script><script src="/vuepressblog/assets/js/27.3d604a05.js" defer></script><script src="/vuepressblog/assets/js/9.76c7ad5c.js" defer></script>
  </body>
</html>
